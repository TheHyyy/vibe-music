# QQ 音乐播放方案对比 - 真实情况

## ⚠️ 重要结论

经过充分测试，**目前没有真正无需登录就能获取 QQ 音乐播放链接的 npm 包**。

## 测试结果

### 1. qq-music-api ❌
- **需要 Cookie**：必须配置有效的 QQ_COOKIE
- **测试结果**：没有 Cookie 时返回 "获取链接失败，建议检查是否登录"
- **结论**：必须登录

### 2. @meting/core ❌
- **声称**：无需登录
- **实际测试**：可以搜索，但获取播放链接返回 `{"url":"","size":0,"br":-1}`
- **结论**：搜索无需登录，播放需要登录

### 3. music-api@0.3.11 ❌
- **声称**：支持 QQ 音乐
- **实际测试**：使用的 API 已失效，返回 JSON 解析错误
- **结论**：已过时，不可用

### 4. Rain120 QQ Music API ❌
- **类型**：需要自己部署的服务端
- **部署要求**：需要服务器、需要配置
- **结论**：不是 npm 包，需要额外部署

### 5. jsososo/QQMusicApi ❌
- **类型**：需要自己部署的服务端
- **部署要求**：需要服务器、需要 Cookie
- **结论**：不是 npm 包，需要额外部署

## 为什么无法绕过登录？

QQ 音乐的播放链接获取机制：
1. **VKey 验证**：每次播放需要动态获取 VKey
2. **登录态验证**：VKey 获取需要有效的登录态
3. **VIP 限制**：部分歌曲需要 VIP 权限
4. **防盗链**：播放链接有时间限制和域名限制

## 可行的解决方案

### 方案 A：配置 QQ 音乐 Cookie（推荐）

**优点**：
- ✅ 可以播放所有免费歌曲
- ✅ 如果有 VIP，可以播放 VIP 歌曲
- ✅ 搜索和播放都正常工作

**缺点**：
- ❌ 需要手动获取 Cookie
- ❌ Cookie 会过期（7-30天）
- ❌ 需要定期更新

**实施步骤**：
```bash
# 1. 获取 Cookie（参考 QQ_MUSIC_COOKIE_GUIDE.md）
# 2. 配置到 .env
echo "QQ_COOKIE=你的完整cookie" >> server/.env

# 3. 重启服务
# tsx watch 会自动重启
```

### 方案 B：使用网易云音乐（无需登录）

**优点**：
- ✅ 完全无需登录
- ✅ 有大量免费歌曲
- ✅ 已经在项目中工作

**缺点**：
- ❌ 没有 QQ 音乐的独家版权歌曲
- ❌ 部分歌曲可能需要 VIP

**实施步骤**：
```bash
# 搜索时指定网易云
curl 'http://localhost:3000/api/songs/search?q=晴天&source=netease'

# 或搜索所有平台
curl 'http://localhost:3000/api/songs/search?q=晴天&source=all'
# 然后播放 ID 以 netease: 开头的歌曲
```

### 方案 C：部署第三方 API 服务

**优点**：
- ✅ 可以自定义功能
- ✅ 可以缓存播放链接

**缺点**：
- ❌ 需要服务器
- ❌ 需要维护
- ❌ 可能仍然需要 Cookie

**推荐项目**：
- [jsososo/QQMusicApi](https://github.com/jsososo/QQMusicApi)
- [Rain120/qq-music-api](https://github.com/Rain120/qq-music-api)

## 我的建议

### 短期方案（立即可用）
1. **使用网易云音乐**：无需任何配置，已经可以工作
2. **搜索两个平台**：`source=all` 会同时搜索网易云和 QQ 音乐
3. **优先播放网易云**：ID 以 `netease:` 开头的歌曲可以直接播放

### 长期方案（推荐）
1. **配置 QQ 音乐 Cookie**：只需要 5 分钟
2. **定期更新 Cookie**：每 2-3 周更新一次
3. **享受完整功能**：两个平台的歌曲都可以播放

## 技术原理

### QQ 音乐的播放链接获取流程
```
1. 用户请求播放 -> 2. 获取 VKey（需要登录态）
                  ↓
3. 拼接播放 URL -> 4. 验证权限（VIP/免费）
                  ↓
5. 返回播放链接 -> 6. 播放链接有时效性
```

### 网易云音乐的播放链接获取流程
```
1. 用户请求播放 -> 2. 直接获取播放链接（无需登录）
                  ↓
3. 返回播放链接 -> 4. 即可播放
```

## 常见问题

### Q: 为什么别人说可以无需登录？
A: 可能是：
1. 使用的是旧 API（已失效）
2. 只能搜索，不能播放
3. 使用的是第三方服务（实际上那个服务有 Cookie）

### Q: 能否使用公开的 QQ 音乐 API？
A: 官方没有公开的 API，第三方公开 API 通常：
1. 不稳定
2. 有频率限制
3. 可能随时关闭

### Q: Cookie 安全吗？
A:
1. Cookie 存储在本地 `.env` 文件中
2. 不会上传到任何地方
3. 只用于获取播放链接
4. 建议使用小号的 Cookie

## 总结

**没有真正无需登录的 QQ 音乐播放方案**。

如果你需要 QQ 音乐的歌曲：
1. **最简单**：配置 Cookie（5分钟）
2. **最省事**：使用网易云音乐（无需配置）
3. **最灵活**：自己部署 API 服务

---

**建议**：先使用网易云音乐，等需要 QQ 音乐独家歌曲时再配置 Cookie。
